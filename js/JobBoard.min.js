var pagination=null;function shuffle(array){for(var currentIndex=array.length,temporaryValue,randomIndex;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),temporaryValue=array[currentIndex-=1],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}function getRandomInt(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min}$(document).ready((function(){function formatResult(item){return item.Title}function formatSelection(item){return item.Title}function getURLParam(name,url){for(var query_string,params=(url=decodeURIComponent(url)).split("?")[1].split("&"),i=0;i<params.length;){var param_item=params[i].split("=");if(param_item[0]==name)return param_item[1];i++}return""}$(".selectCompany").select2({width:"100%",placeholder:"Company",minimumResultsForSearch:1/0}),$(".selectLocation").select2({width:"100%",placeholder:"Location",minimumResultsForSearch:1/0})})),document.onreadystatechange=function(){"complete"===document.readyState&&$(".loadingSpinner").fadeOut(50)},vm_Main=new Vue({el:".main",data:{allPosts:[],searchResults:[],displayPosts:[],noPosts:[{Title:"No Vacancies",Description:"Unfortunately there are currently no vacancies for this area. However new positions are added all the time so please check back soon.",CompanyImage:"https://corporatedocument.sharepoint.com/sites/bgintranet/SitePages/Intranet/assets/images/mm_images/Group_trans.png",ActiveLink:!1,Style:"blue"}]},created:function(){this.getJobs()},methods:{getJobs:function(){var vm=this,endPointUrl=siteURL+"/_api/Web/Lists/getbytitle('RSSFeeds')/Items?&$filter=Title eq 'JobBoard'";axios.get(endPointUrl).then(response=>{var xmlString=0==response.length?null:response.data.value[0].xml;if(null!=xmlString){var xmlDOM=(new DOMParser).parseFromString(xmlString,"text/xml"),jsonObject=vm.xmlToJson(xmlDOM),entries=[];Array.isArray(jsonObject.rss.channel.item)?entries=jsonObject.rss.channel.item:entries.push(jsonObject.rss.channel.item),entries.forEach((function(entry){var nbPost=[],jobDescription=vm.stripHTML(entry.vacancydescription),elip=jobDescription.length>280?" ....":"",Company=entry.company,CompanyImage="";switch(Company.toLowerCase()){case"cds":CompanyImage="cds2020.png";break;case"cds defence support":case"cds defence and security":CompanyImage="cds_ds.png";break;case"bgbs":CompanyImage="bgbs.png";break;case"newspress":CompanyImage="newspress.png";break;default:CompanyImage="Group_Bailie.png"}nbPost.Title=entry.title,nbPost.Description=jobDescription.slice(0,280)+elip,nbPost.Link=entry.link,nbPost.Company=Company,nbPost.Location=entry.location,nbPost.CompanyImage="https://corporatedocument.sharepoint.com/sites/bgintranet/SitePages/Intranet/assets/images/mm_images/"+CompanyImage,nbPost.Style=getColour(),nbPost.ActiveLink=null!=nbPost.Link,vm.allPosts.push(nbPost)}))}Array.isArray(vm.allPosts)&&vm.allPosts.length?vm.displayPosts=vm.allPosts.slice(0):vm.displayPosts=vm.noPosts,vm.displayPosts.reverse(),vm.$nextTick((function(){handlePagination()}))}).catch((function(err){console.log(err),vm.displayPosts=vm.noPosts}))},xmlToJson:function(xml){var vm=this,obj={};if(1==xml.nodeType){if(xml.attributes.length>0){obj["@attributes"]={};for(var j=0;j<xml.attributes.length;j++){var attribute=xml.attributes.item(j);obj["@attributes"][attribute.nodeName]=attribute.nodeValue}}}else 3==xml.nodeType&&(obj=xml.nodeValue);if(xml.hasChildNodes()&&1===xml.childNodes.length&&3===xml.childNodes[0].nodeType)obj=xml.childNodes[0].nodeValue;else if(xml.hasChildNodes())for(var i=0;i<xml.childNodes.length;i++){var item=xml.childNodes.item(i),nodeName=item.nodeName;if(void 0===obj[nodeName])obj[nodeName]=vm.xmlToJson(item);else{if(void 0===obj[nodeName].push){var old=obj[nodeName];obj[nodeName]=[],obj[nodeName].push(old)}obj[nodeName].push(vm.xmlToJson(item))}}return obj},stripHTML:function(html){var tmp=document.createElement("DIV");return tmp.innerHTML=html,tmp.textContent||tmp.innerText||""},searchPosts:function(){var term=""==$("#searchTerm").val()?"*":$("#searchTerm").val(),termCompany=""==$(".selectCompany").val()||"All"==$(".selectCompany").val()?"*":$(".selectCompany").val(),termCompany="CDS DS"==$(".selectCompany").val()?"CDS Defence Support":termCompany,termLocation=""==$(".selectLocation").val()||"All"==$(".selectLocation").val()?"*":$(".selectLocation").val(),vm=this,termArray=[],companyArray=[];if("*"==term&"*"==termCompany&"*"==termLocation)return vm.displayPosts=vm.allPosts.slice(0),void vm.$nextTick((function(){handlePagination()}));termArray="*"!=term?vm.allPosts.filter((function(el){return console.log(el),(el.Description.toLowerCase()+el.Title.toLowerCase()).includes(term.toLowerCase())})):vm.allPosts.slice(0),companyArray="*"!=termCompany?termArray.filter((function(el){return el.Company==termCompany})):termArray.slice(0),vm.searchResults="*"!=termLocation?companyArray.filter((function(el){return el.Location.includes(termLocation)})):companyArray.slice(0),Array.isArray(vm.searchResults)&&vm.searchResults.length?vm.displayPosts=vm.searchResults.slice(0):(vm.noPosts[0].Style=getColour(),vm.displayPosts=vm.noPosts),vm.$nextTick((function(){handlePagination()}))}}}),getColour=function(){let COLORS;return["green","yellow","purple","pink","blue"][getRandomInt(0,4)]},$(".breadcrumb").click((function(){$("#searchTerm").val(""),$(".selectCompany").val("").trigger("change"),$(".selectLocation").val("").trigger("change"),vm_Main.searchPosts()})),handlePagination=function(){var items=$(".list-wrapper .list-item"),numItems=items.length,perPage=6;items.slice(6).hide(),$("#pagination-container").pagination({items:numItems,itemsOnPage:6,prevText:"Prev",nextText:"Next",onPageClick:function(pageNumber){var showFrom=6*(pageNumber-1),showTo=showFrom+6;items.hide().slice(showFrom,showTo).show()}})};