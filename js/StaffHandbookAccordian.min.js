function onlyUnique(value,index,self){return self.indexOf(value)===index}$(document).ready((function(){vm_Main.checkSize(),$(window).resize(vm_Main.checkSize)})),vm_Main=new Vue({el:"#wrapper",data:{paras:[],headerToShow:"",paraToShow:"",vCode:"",l3:"",typeaheadKeywords:[]},created:function(){this.getHandbook()},methods:{getHandbook:function(){var user=JSON.parse(localStorage.getItem("userDetails"));console.log("User");var vm=this,company="BGBS"==user.Company.toUpperCase()?"CDS":user.Company.toUpperCase();company=""==user.Company?"NEWSPRESS":user.Company.toLowerCase();var requestUri=peopleURL+"/_api/web/lists/getbytitle('Staff Handbook Repository')/items?$top=1000&$select=Title,Category,SectionTile,Section_x0020_Wording,SortTest4&$filter=((Audience eq null) or (Audience eq '"+company+"'))";axios.get(requestUri).then(response=>{var data="",responses=response.data.value,allCategories=[];responses.forEach(element=>{if(element.sortOrder=parseFloat(element.SortTest4),element.searchHeader=element.SectionTile,allCategories.push(element.Category),"purpose"==element.SectionTile.toLowerCase()){var parentID="",levels=element.Title.split(".");for(i=0;i<levels.length-1;i++)parentID+=levels[i]+".";parentID=parentID.substring(0,parentID.length-1);var parent=responses.find((function(element){return element.Title==parentID}));element.searchHeader=parent.SectionTile}}),vm.paras=responses.sort((function(a,b){return(a.sortOrder>b.sortOrder)-(a.sortOrder<b.sortOrder)}));var Categories=allCategories.filter(onlyUnique).sort(),TestCategories,user=JSON.parse(localStorage.getItem("userDetails")),handBookAdmin=user.Roles.includes("Handbook Administrator");"cyprus"!=user.Office.toLowerCase()&&0==handBookAdmin&&(Categories=Categories.filter((function(value,index,arr){return 0==value.toLowerCase().includes("cyprus")})));var topLevel=[],secondlevel=[],thirdLevel=[];vm.paras.forEach(element=>{null!=element.Section_x0020_Wording&&vm.typeaheadKeywords.push(element.Title+" - "+element.searchHeader);var paraNo=element.Title.split(".");1==paraNo.length?topLevel.push(element):2==paraNo.length?secondlevel.push(element):thirdLevel.push(element)}),console.log("vm.paras"),console.log(vm.paras),Categories.forEach(category=>{vm.l3+='<li><a class="toggle Category" id="'+category.replace(/ /g,"")+'" href="javascript:void(0);">'+category+"</a>",vm.l3+='<ul class="inner">',topLevel.filter(element=>element.Category==category).forEach(l1Element=>{vm.l3+='<li><a class="toggle Toplevel" id="'+l1Element.Title.split(".").join("_")+'" href="javascript:void(0);">'+l1Element.Title+" - "+l1Element.SectionTile,null!=l1Element.Section_x0020_Wording&&(vm.l3+='<i data-toggle="tooltip" data-placement="top" title="Copy Link To Clipboard" class="far fa-clipboard">'),vm.l3+="</i></a>";var secondLevelFilter=secondlevel.filter(code=>code.Title.split(".")[0]==l1Element.Title);0!=secondLevelFilter.length?(vm.l3+='<ul class="inner">',null!=l1Element.Section_x0020_Wording&&(vm.l3+='<li class="paraContent">'+l1Element.Section_x0020_Wording+"</li>"),secondLevelFilter.forEach(l2Element=>{vm.l3+='<li><a href="#" class="toggle Secondlevel" id="'+l2Element.Title.split(".").join("_")+'">'+l2Element.Title+" - "+l2Element.SectionTile,null!=l2Element.Section_x0020_Wording&&(vm.l3+='<i data-toggle="tooltip" data-placement="top" title="Copy Link To Clipboard" class="far fa-clipboard">'),vm.l3+="</i></a>";var thirdLevelFilter=thirdLevel.filter(code=>code.Title.split(".")[0]+"."+code.Title.split(".")[1]==l2Element.Title);0!=thirdLevelFilter.length?(vm.l3+='<ul class="inner">',null!=l2Element.Section_x0020_Wording&&(vm.l3+='<li class="paraContent">'+l2Element.Section_x0020_Wording+"</li>"),thirdLevelFilter.forEach(l3Element=>{vm.l3+='<li><a href="#" class="toggle ThirdLevel" id="'+l3Element.Title.split(".").join("_")+'">'+l3Element.Title+" - "+l3Element.SectionTile+'<i data-toggle="tooltip" data-placement="top" title="Copy Link To Clipboard" class="far fa-clipboard"></i></a>',null!=l3Element.Section_x0020_Wording&&(vm.l3+='<ul class="inner"  id="'+l3Element.Title.split(".").join("_")+'"><li class="paraContent">'+l3Element.Section_x0020_Wording+"</li></ul>")}),vm.l3+="</ul>"):null!=l2Element.Section_x0020_Wording&&(vm.l3+='<ul class="inner"  id="'+l2Element.Title.split(".").join("_")+'"><li class="paraContent">'+l2Element.Section_x0020_Wording+"</li></ul>")})):null!=l1Element.Section_x0020_Wording&&(vm.l3+='<ul class="inner"  id="'+l1Element.Title.split(".").join("_")+'"><li class="paraContent">'+l1Element.Section_x0020_Wording+"</li>"),vm.l3+="</ul></li>"}),vm.l3+="</ul></li>"}),vm.$nextTick((function(){$("i").tooltip(),$(".toggle").click((function(e){e.preventDefault();var $this=$(this);$this.next().hasClass("show")?($this.next().removeClass("show"),$this.next().slideUp(350)):($this.parent().parent().find("li .inner").removeClass("show"),$this.parent().parent().find("li .inner").slideUp(350),$this.next().toggleClass("show"),$this.next().slideToggle(350))})),$(".fa-clipboard").click((function(e){var n=window.location.href.lastIndexOf("/"),staffHandbookURL=window.location.href.substring(0,n+1)+"StaffHandbook.aspx?srch=";let tmp=document.createElement("input"),srchKey=e.target.parentNode.innerText;var srchKeySplit=srchKey.toLowerCase().split(" - ");if("purpose"==srchKeySplit[1].trim()){var currID,parID=$(e.target).parent().attr("id").split("_")[0],parElem,parentText=$("#"+parID)[0].text.split(" - ")[1];srchKey=srchKeySplit[0]+" - "+parentText}tmp.value=staffHandbookURL+srchKey,document.body.appendChild(tmp),tmp.select(),document.execCommand("copy"),Swal.fire({title:'"'+srchKey+'"',text:"Link Has Been Copied To The Clipboard.",icon:"success",confirmButtonText:"Cool",timer:2500}),document.body.removeChild(tmp),e.stopPropagation()})),vm.configTypeAhead();var srchCriteria=qs("srch");$("#searchBox").val(srchCriteria),$(".loadingSpinner").fadeOut(50),null!=srchCriteria&&vm.searchEvent()}))})},expendSection:function(elem){elem.next().hasClass("show")?elem.next().removeClass("show"):(elem.parent().parent().find("li .inner").removeClass("show"),elem.next().toggleClass("show"),elem.next().slideToggle(350))},searchEvent:function(){var vm=this;$("*").removeClass("show"),$(".toggle").removeClass("show"),$(".inner").removeClass("show"),$(".inner").slideUp(350),$("#mobileSearchBox").blur();var searchTerm="none"==$(".mobileSearch").css("display")?$("#searchBox").val():$("#mobileSearchBox").val();if(""!=searchTerm){var wordings,searchresults=vm.paras.filter(code=>null!=code.Section_x0020_Wording).filter(code=>code.Section_x0020_Wording.toLowerCase().includes(searchTerm.toLowerCase())||(code.Title+" - "+code.searchHeader).toLowerCase().includes(searchTerm.toLowerCase()));console.log("searchTerm"),console.log(searchTerm),console.log("searchresults"),console.log(searchresults),searchresults.forEach(element=>{var searchParas=element.Title.split("."),cat=element.Category.replace(/ /g,"");$("#"+cat).hasClass("show")||(vm.expendSection($("#"+cat)),$("#"+cat).toggleClass("show")),1==searchParas.length?$("#"+searchParas[0]).hasClass("show")||(vm.expendSection($("#"+searchParas[0])),$("#"+searchParas[0]).toggleClass("show")):2==searchParas.length?($("#"+searchParas[0]).hasClass("show")||(vm.expendSection($("#"+searchParas[0])),$("#"+searchParas[0]).toggleClass("show")),$("#"+searchParas[0]+"_"+searchParas[1]).hasClass("show")||(vm.expendSection($("#"+searchParas[0]+"_"+searchParas[1])),$("#"+searchParas[0]+"_"+searchParas[1]).toggleClass("show"))):($("#"+searchParas[0]).hasClass("show")||(vm.expendSection($("#"+searchParas[0])),$("#"+searchParas[0]).toggleClass("show")),$("#"+searchParas[0]+"_"+searchParas[1]).hasClass("show")||(vm.expendSection($("#"+element.Category)),vm.expendSection($("#"+searchParas[0]+"_"+searchParas[1])),$("#"+searchParas[0]+"_"+searchParas[1]).toggleClass("show")),$("#"+searchParas[0]+"_"+searchParas[1]+"_"+searchParas[2]).hasClass("show")||(vm.expendSection($("#"+element.Category)),vm.expendSection($("#"+searchParas[0]+"_"+searchParas[1]+"_"+searchParas[2])),$("#"+searchParas[0]+"_"+searchParas[1]+"_"+searchParas[2]).toggleClass("show")))}),console.log(searchresults[0].Title.replace(/\./g,"_")),$("body,html").animate({scrollTop:$("#"+searchresults[0].Title.replace(/\./g,"_")).offset().top},2e3)}},configTypeAhead:function(){var vm,keywords=this.typeaheadKeywords,keywords=new Bloodhound({datumTokenizer:Bloodhound.tokenizers.whitespace,queryTokenizer:Bloodhound.tokenizers.whitespace,local:keywords});$(".typeahead").typeahead({hint:!0,highlight:!0,minLength:1},{name:"keywords",source:keywords})},checkSize:function(){var vm=this;$("#mobileSearchBox, #searchBox, .searchBox, .mobileSearchBox").unbind(),$("#searchBox").on("typeahead:selected",(function(){vm.searchEvent()})),$("#searchBox, #mobileSearchBox").on("search",(function(){vm.searchEvent()})),$(".searchBox, .mobileSearchBox").click(()=>{vm.searchEvent()})}}});