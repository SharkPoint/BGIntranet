var slider,nominee;function validateForm(){if($(".status").css("color","red"),null==$("#iceNominee").select2("data"))return $(".status").html("Please Select The Person You Wish To Nominate"),!1;var localUser=store.get("userDetails");console.log(localUser);var obj=$("#iceNominee").select2("data");return localUser.DisplayName==obj.FullName?($(".status").html("You Cannot Nominate Yourself For An Award"),!1):(console.log("Nominee Company = "+nominee.Company),"cds"!=nominee.Company.toLowerCase()&&"bgbs"!=nominee.Company.toLowerCase()||0!=$("#CDSIntegrityChecked").is(":checked")||0!=$("#CDSChallengingChecked").is(":checked")||0!=$("#CDSCuriosityChecked").is(":checked")||0!=$("#CDSTenacityChecked").is(":checked")||0!=$("#CDSTogethernessChecked").is(":checked")?"cdsds"==nominee.Company.toLowerCase()&&0==$("#CDSDSCollaborativeChecked").is(":checked")&&0==$("#CDSDSTrustedChecked").is(":checked")&&0==$("#CDSDSExemplarChecked").is(":checked")&&0==$("#CDSDSVisionaryChecked").is(":checked")?($(".status").html("Please Select At Least One Of The Values"),!1):"newspress"==nominee.Company.toLowerCase()&&0==$("#NPTrustedChecked").is(":checked")&&0==$("#NPExpertChecked").is(":checked")&&0==$("#NPDeterminedChecked").is(":checked")&&0==$("#NPEnrichingChecked").is(":checked")&&0==$("#NPBoldChecked").is(":checked")&&0==$("#NPCaringChecked").is(":checked")?($(".status").html("Please Select At Least One Of The Values"),!1):0==$("#reason").val()?($(".status").html("How Has This Person Exceeded Your Expectations"),!1):($(".status").css("color","green"),$(".status").html("Sending..."),!0):($(".status").html("Please Select At Least One Of The Values"),!1))}function GenerateThumbnail(p_Url){if(void 0===p_Url||""===p_Url)return null;var filename=p_Url.substring(p_Url.lastIndexOf("\\")+1),filePath=p_Url.substring(0,p_Url.lastIndexOf("\\")),fileNameWithoutExtension=filename.substring(0,filename.lastIndexOf(".")),ext=filename.substring(filename.lastIndexOf(".")+1),thumbNail;return filePath+"\\_t\\"+encodeURIComponent(fileNameWithoutExtension).replace(/%2520/g,"%20")+"_"+ext+"."+ext}function imgError(image){return image.onerror="",image.src="images/missingprofile.jpg",!0}function Nominate(){var localUser;InitialiseForm(),GetCurrentUser(),DisplayValues(JSON.parse(localStorage.getItem("userDetails")).Company),slider.stopSlider(),$("#ice_form_modal").modal("show")}function Back2BIG(){window.open("../index.aspx","_self")}function ViewMyApprovals(){window.open("https://emea.flow.microsoft.com/manage/environments/Default-19007d4a-254f-4fbf-8c8d-c59b6d32b766/approvals/received","_blank")}function ViewNominations(){window.open("https://corporatedocument.sharepoint.com/sites/bgintranet/Lists/IceAwards/In%20Process.aspx","_blank")}function saveIce(){if(0!=validateForm()){var localUser,firstName=store.get("userDetails").DisplayName.split(" ")[0],successText="Thank You "+firstName+" Your Nomination Has Been Submitted.",failText="Sorry "+firstName+", please try again.";toastr.options={closeButton:!0,debug:!1,newestOnTop:!0,progressBar:!1,positionClass:"toast-top-full-width",preventDuplicates:!0,showDuration:"300",hideDuration:"1000",timeOut:"0",extendedTimeOut:"1000",showEasing:"swing",hideEasing:"linear",showMethod:"fadeIn",hideMethod:"fadeOut"};var values="",mt_webServerRelativeUrl="/sites/bgintranet",mt_webAbsoluteUrl="https://corporatedocument.sharepoint.com/sites/bgintranet";$("#CDSIntegrityChecked").is(":checked")&&(values+="Integrity "),$("#CDSChallengingChecked").is(":checked")&&(values+="Challenging "),$("#CDSCuriosityChecked").is(":checked")&&(values+="Curiosity "),$("#CDSTenacityChecked").is(":checked")&&(values+="Tenacity "),$("#CDSTogethernessChecked").is(":checked")&&(values+="Togetherness "),$("#CDSDSCollaborativeChecked").is(":checked")&&(values+="Collaborative "),$("#CDSDSTrustedChecked").is(":checked")&&(values+="Trusted "),$("#CDSDSExemplarChecked").is(":checked")&&(values+="Exemplar "),$("#CDSDSVisionaryChecked").is(":checked")&&(values+="Visionary "),$("#NPTrustedChecked").is(":checked")&&(values+="Trusted "),$("#NPExpertChecked").is(":checked")&&(values+="Expert "),$("#NPDeterminedChecked").is(":checked")&&(values+="Determined "),$("#NPEnrichingChecked").is(":checked")&&(values+="Enriching "),$("#NPBoldChecked").is(":checked")&&(values+="Bold "),$("#NPCaringChecked").is(":checked")&&(values+="Caring ");var obj=$("#iceNominee").select2("data"),reason=$("#reason").val();console.log(obj),GetUserIdByEmail(obj.Email).then(data=>{console.log("UserID"),console.log(data);var itemProperties={Title:"Ice Award",NomineeId:data.d.Id,Pillars:values.trim(),Reason:reason};createSPListItem(mt_webAbsoluteUrl,"Ice Awards",itemProperties).done(()=>{var intURL="../index.aspx";$("#ice_form_modal").modal("toggle"),toastr.options.onclick=function(){window.location.href=intURL},toastr.success(successText+"<br/><a href'"+intURL+'\' style="font-style: oblique">Click Here To Return To Intranet</a>',"Submission Successful")}).fail((function(error){toastr.error(failText,"Submission Failed")}))})}}function DisplayValues(company){switch(console.log("Company - "+company),company.toLowerCase()){case"cds":$("#CDSDS").hide(),$("#CDS").show(),$("#NewsPress").hide();break;case"cdsds":case"cds ds":$("#CDSDS").show(),$("#CDS").hide(),$("#NewsPress").hide();break;case"newspress":$("#CDSDS").hide(),$("#CDS").hide(),$("#NewsPress").show();break;case"bgbs":default:$("#CDSDS").hide(),$("#CDS").show(),$("#NewsPress").hide()}}function InitialiseForm(){$("#iceNominee").select2("val",""),$("#reason").val(""),$(".status").html(""),$("#CDSIntegrityChecked").prop("checked",!1),$("#CDSChallengingChecked").prop("checked",!1),$("#CDSCuriosityChecked").prop("checked",!1),$("#CDSTenacityChecked").prop("checked",!1),$("#CDSTogethernessChecked").prop("checked",!1),$("#CDSDSCollaborativeChecked").prop("checked",!1),$("#CDSDSTrustedChecked").prop("checked",!1),$("#CDSDSExemplarChecked").prop("checked",!1),$("#CDSDSVisionaryChecked").prop("checked",!1),$("#NPTrustedChecked").prop("checked",!1),$("#NPExpertChecked").prop("checked",!1),$("#NPDeterminedChecked").prop("checked",!1),$("#NPEnrichingChecked").prop("checked",!1),$("#NPBoldChecked").prop("checked",!1),$("#NPCaringChecked").prop("checked",!1)}function ShowVideo(){slider.stopSlider(),$("#videoModal").modal("toggle")}function GetCurrentUser(){null==store.get("userdetails")&&axios("https://corporatedocument.sharepoint.com/_api/SP.UserProfiles.PeopleManager/GetMyProperties").then(response=>{var uDetails={OneDriveAddress:response.data.PersonalUrl+"/_layouts/15/onedrive.aspx",EmailAddress:response.data.Email,AccountName:response.data.AccountName,Company:response.data.Email.split("@").pop().split(".").shift().toLowerCase()};sessionStorage.setItem("userDetails",JSON.stringify(uDetails))}).catch(error=>{console.log("Current User Error - "+error)})}function checkUserApprover(){$(".view_approvals").css("visibility","hidden"),$(".view_nominations").css("visibility","hidden");var localUser,userName=JSON.parse(localStorage.getItem("userDetails")).EmailAddress,approverListURL=siteURL+"/_api/web/lists/getbytitle('Ice Awards Admin')/items?$select=PersonName/UserName,PersonName/ID,PersonName/Title,Role&$expand=PersonName";axios.get(approverListURL).then(response=>{var approvers;response.data.value.forEach(element=>{element.PersonName.UserName.toLowerCase()==userName.toLowerCase()&&"Approver"==element.Role&&($(".view_approvals").css("visibility","visible"),$(".view_nominations").css("visibility","visible")),element.PersonName.UserName.toLowerCase()==userName.toLowerCase()&&"Exec"==element.Role&&$(".view_nominations").css("visibility","visible")})})}$(document).ready((function(){checkUserApprover();var excludedJobTitles=["contractor","external","exclude","review","service account"];$("#iceNominee").select2({allowClear:!0,placeholder:"<i class='fas fa-user fa-lg'></i>&nbsp;&nbsp;Who Would You Like To Nominate ?",minimumInputLength:3,ajax:{url:"https://corporatedocument.sharepoint.com/sites/bgintranet/_api/web/lists/getbytitle('UserProfileInfoV2')/items?&$top=1000",dataType:"json",data:function(term,page){return{$filter:"((substringof('"+term+"', FullName)) and (ProfileVisible eq 1))"}},results:function(data,page){return $("#iceNominee").select2("val",""),{results:data.d.results}},params:{contentType:"application/json;odata=verbose",headers:{accept:"application/json;odata=verbose"}}},id:function(person){return{id:person.Id}},formatResult:function(person){if(-1==excludedJobTitles.indexOf(person.JobTitle.toLowerCase())){var pic=person.PictureURL;return res="<img src='"+pic+"' style='width:50px;height50px;border-radius:50%' onerror='imgError(this)'>&nbsp&nbsp"+person.FullName,res}},formatSelection:function(person){return person.FullName},formatNoMatches:function(){return"No people found."},escapeMarkup:function(m){return m},dropdownCssClass:"bigdrop"}).on("change",(function(e){null!=(nominee=$(this).select2("data"))&&(console.log(nominee),DisplayValues(nominee.Company))})),(slider=new XPRO.Controls.Slider(null)).initSlider("scroller",{mode:"slideOut",dir:"up",iniWidth:1200,iniHeight:600,autoRun:!0,interval:1e4,autoHeightMode:"maintainratio",thumbnails:null,stopOnHover:!1,imageVAlign:"bottom",showProgress:!1,enableNavigation:!1,onAdjustHeight:function(theslider){var aH,top;return jQuery(window).innerHeight()-jQuery(theslider.rt.scroller).position().top}}),$("#ice_form_modal").on("hidden.bs.modal",(function(e){slider.run()})),$("#videoModal").on("hidden.bs.modal",(function(e){$("#videoModal iframe").attr("src",$("#videoModal iframe").attr("src")),slider.run()})),jQuery(".xp-custom-navigation").on("click",(function(){return slider.forward(),!1}))})),$((function(){var requiredCheckboxes=$(".CompanyValues :checkbox[required]");requiredCheckboxes.change((function(){requiredCheckboxes.is(":checked")?requiredCheckboxes.removeAttr("required"):requiredCheckboxes.attr("required","required")}))})),document.onreadystatechange=function(){"complete"===document.readyState&&$(".loadingSpinner").fadeOut("slow")};