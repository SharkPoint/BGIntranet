var gridLocked=!0;function showNews(id){var elem=$("#"+id),thumb=elem.attr("thumb"),link=elem.attr("nlink");window.open(link,"_blank")}function initialise(){var calEntries;getSpotlight(),$(".evendar-container").remove(),0==$("#whatsHappeningEvendar").length&&$(".whatsHappeningBody").append('<input type="text" id="whatsHappeningEvendar" />'),getCalendarEntries().then(response=>{calEntries=getFormattedCalendarEntries(response.data.value);var test=$("#whatsHappeningEvendar").evendar({events:calEntries,format:"DD-MM-YYYY HH:mm",calendarCount:1,oneCalendarWidth:340,inline:!0,staticBoxHeight:!0,boxHeight:422,enableGridView:!1,enableMinimize:!1,enableMaximize:!1,defaultEventColor:"#fff",defaultEventImage:"./assets/images/calendarEventHdr.jpg",locale:"en-gb"})}),$("#s2id_searchName").remove(),$("#searchName").remove(),$("#searchJob").before('<input class="searchField" id="searchName" type="text" placeholder="Search by name" />'),$("#searchName").select2({allowClear:!0,placeholder:"<i class='fas fa-user fa-lg'></i>&nbsp;&nbsp;People Finder",minimumInputLength:3,ajax:{url:"https://corporatedocument.sharepoint.com/sites/bgintranet/_api/web/lists/getbytitle('UserProfileInfoV2')/items?&$top=1000",dataType:"json",data:function(term,page){return{$filter:"((substringof('"+term+"', FullName)) and (ProfileVisible eq 1))"}},results:function(data,page){var res;return $("#select2-chosen-1","#select2-chosen-2").css({"padding-top":"7px","padding-left":"8px"}),$("#searchName").select2("val",""),{results:data.d.results.sort((function(a,b){return(a=a.FullName.toLowerCase())>(b=b.FullName.toLowerCase())?1:a<b?-1:0}))}},params:{contentType:"application/json;odata=verbose",headers:{accept:"application/json;odata=verbose"}}},id:function(person){return{id:person.ID}},formatResult:function(person,container){var pic=person.PictureURL;return res="<img src='"+pic+"' style='width:50px;height50px;border-radius:50%;' onerror='imgError(this)'>&nbsp&nbsp"+person.FullName,res},formatSelection:function(person,container){$("#select2-chosen-1,.select2-choice, #select2-chosen-2").css({"padding-top":"0px","padding-left":"0px"});var pic=person.PictureURL,phone=null!=person.WorkPhoneNumber?person.WorkPhoneNumber:"";res='<div class="banner"><p><img src="'+pic+'" + width="40px" height="40px" onerror=\'imgError(this)\' class="profileImage" align="left"><span class="ban1" style="display:flex;text-align:left;padding-left:10px;height:100%;line-height:40px;">'+person.FullName+"</span></p></div>",container.append($('<span class="selected-state"></span>').html(res))},formatNoMatches:function(){return"No people found. (Case Sensitive)"},escapeMarkup:function(m){return m},dropdownCssClass:"bigdrop"}).on("change",(function(e){var obj=$(this).select2("data"),phoneNumber=null!=obj.WorkPhoneNumber?obj.WorkPhoneNumber:"No Phone Found";null==obj?($(".select2-choice").css({"padding-top":"7px","padding-left":"8px"}),$("#FindPeople .subHeadline2").text("Find"),$("#FindPeople .subHeadline").text("People"),0==$("#PeopleFinderImg").hasClass("hideProfile")&&$("#PeopleFinderImg").addClass("hideProfile"),$("#FindPeople .subHeadline").unbind(),$("#emailAddress").val("")):($("#FindPeople .subHeadline").unbind(),$("#emailAddress").val(obj.Email),$("#FindPeople .subHeadline2").html("<a href='mailto:"+obj.Email+"'>"+obj.FullName+"</a>"),$("#FindPeople .subHeadline").text(phoneNumber),$("#FindPeople .subHeadline").mouseover((function(){$("#FindPeople .subHeadline").css("cursor","pointer")})).mouseout((function(){$("#FindPeople .subHeadline").css("cursor","default ")})),$("#FindPeople .subHeadline").click((function(){$("#FindPeople .subHeadline").text()==obj.WorkPhoneNumber&&null!=obj.WorkMobileNumber?$("#FindPeople .subHeadline").text(obj.WorkMobileNumber):$("#FindPeople .subHeadline").text(obj.WorkPhoneNumber)})),$("#PeopleFinderImg").attr("src",obj.PictureURL),checkFileExistence(obj.PictureURL)&&$("#PeopleFinderImg").removeClass("hideProfile"))})),$(".Spotlight").click(()=>{if(1==gridLocked){var profileEmail=$("#profileID").val();peopleFinderURL="PeopleDirectory.aspx?p="+profileEmail,window.open(peopleFinderURL,target="_self")}}),$(".NewStarter").click(()=>{1==gridLocked&&null!=$("#TMIVideoURL").attr("name")&&(tmiURL="./news.aspx?pageURL="+$("#TMIVideoURL").attr("name"),window.open(tmiURL,target="_self"))}),$("#Engage").click((function(e){1==gridLocked&&window.open("https://app.engageyourpeople.com/login",target="_blank")})),$("#HubSpot").click((function(e){1==gridLocked&&window.open("https://app.hubspot.com/login?loginRedirectUrl=https%3A%2F%2Fapp.hubspot.com%2Fshortlink%2Fdashboard",target="_blank")})),$("#JobBoard").click((function(e){1==gridLocked&&window.open("./JobBoard.aspx",target="_self")})),$("#newsClose").click((function(){closeNews()})),$("#Synergist").click((function(e){1==gridLocked&&window.open("https://cdsltd.synergist.cloud/",target="_blank")})),$("#LoveMyIdea").click((function(){1==gridLocked&&window.open("https://corporatedocument-9eed295e264c7d.sharepoint.com/sites/IntranetIdeaBoard/IdeaBoard/pages/Default.aspx?SPHostUrl=https://corporatedocument.sharepoint.com/sites/IntranetIdeaBoard/&SPLanguage=en-US&SPClientTag=0&SPAppWebUrl=https://CorporateDocument-9eed295e264c7d.sharepoint.com/sites/IntranetIdeaBoard/IdeaBoard/")})),$("#IceAwards").click((function(e){1==gridLocked&&window.open("./IceAwards/IceAwards.aspx",target="_self")})),$("#NoticeBoard").click((function(e){1==gridLocked&&window.open("./noticeboard.aspx",target="_self")})),$("#CorporateTraveller").click((function(e){1==gridLocked&&window.open("https://yourct.corptraveller.co.uk/Account/Login",target="_blank")})),$("#MeetUpCall").click((function(e){1==gridLocked&&window.open("https://manage.meetupcall.com/login",target="_blank")})),$("#FAQ").click((function(e){1==gridLocked&&window.open("./faq.aspx",target="_self")})),$("#AskHR").click((function(e){1==gridLocked&&window.open(" https://forms.office.com/Pages/ResponsePage.aspx?id=Sn0AGU8lv0-MjcWbbTK3ZuqDZB9eOdVEqoeBCbuJYVBUMzlDVUlNSTVWNjdPNVFST1RHTDhBOFg0QS4u",target="_blank")})),$("#Email").click((function(e){1==gridLocked&&window.open("https://outlook.office365.com/owa.cds.co.uk",target="_blank")})),$("#OneDrive").click((function(e){if(1==gridLocked){var userDetails=JSON.parse(localStorage.userDetails);window.open(userDetails.OneDriveAddress,target="_blank")}})),$("#peopleFinderButton").click((function(){if(1==gridLocked){var searchEmail=$("#emailAddress").val(),jobTitle=$("#searchJob").val(),location=$("#searchLocation").val(),term=jobTitle+"&l="+location,delveURL=null;if(""==searchEmail&&""==jobTitle&&""==location)return;""!=searchEmail?(peopleFinderURL="PeopleDirectory.aspx?p="+searchEmail,window.open(peopleFinderURL,target="_self")):""!=term.trim()&&(peopleFinderURL="PeopleDirectory.aspx?j="+term.trim(),window.open(peopleFinderURL,target="_self"))}})),$("#searchTerm").on("keyup",(function(e){if(13==e.keyCode&&""!=$("#searchTerm").val().trim()){var searchURL="https://corporatedocument.sharepoint.com/sites/bigsearch/Pages/results.aspx?k="+$("#searchTerm").val().trim();window.open(searchURL,target="_self")}})),$("#LoveIdeaSubHeadline").fitText(1,{minFontSize:"29px",maxFontSize:"60px"}),$("#LoveIdeaSubHeadline2").fitText(1,{minFontSize:"27px",maxFontSize:"60px"}),$("#IceAwardsSubHeadline").fitText(1,{minFontSize:"29px",maxFontSize:"60px"}),$("#IceAwardsSubHeadline2").fitText(1,{minFontSize:"27px",maxFontSize:"60px"}),$("#MeetUpCallSubHeadline").fitText(1,{minFontSize:"29px",maxFontSize:"60px"}),$("#MeetUpCallSubHeadline2").fitText(1,{minFontSize:"27px",maxFontSize:"60px"}),$("#CorporateTravellerSubHeadline").fitText(1,{minFontSize:"29px",maxFontSize:"60px"}),$("#CorporateTravellerSubHeadline2").fitText(1,{minFontSize:"20px",maxFontSize:"60px"}),$("#EmailSubHeadline").fitText(.95,{minFontSize:"29px",maxFontSize:"60px"}),$("#EmailSubHeadline2").fitText(.95,{minFontSize:"27px",maxFontSize:"60px"}),$("#AskHRSubHeadline").fitText(1,{minFontSize:"28px",maxFontSize:"60px"}),$("AskHRSubHeadline2").fitText(1,{minFontSize:"29px",maxFontSize:"60px"}),$("#NoticeBoardSubHeadline").fitText(.95,{minFontSize:"29px",maxFontSize:"60px"}),$("#NoticeBoardSubHeadline2").fitText(.95,{minFontSize:"27px",maxFontSize:"60px"}),$("#OneDriveSubHeadline").fitText(.95,{minFontSize:"29px",maxFontSize:"60px"}),$("#OneDriveSubHeadline2").fitText(.95,{minFontSize:"27px",maxFontSize:"60px"}),$("#SynergistHeadline").fitText(.95,{minFontSize:"30px",maxFontSize:"150px"}),$("#SynergistLineOne").fitText(1.2,{minFontSize:"12px",maxFontSize:"20px"}),$("#SynergistLineTwo").fitText(1.2,{minFontSize:"12px",maxFontSize:"20px"}),$("#FaqSubHeadline2").fitText(.95,{minFontSize:"10px",maxFontSize:"30px"}),$("#FaqSubHeadline").fitText(.95,{minFontSize:"5px",maxFontSize:"30px"}),$(".loadingSpinner").fadeOut("slow")}function getSpotlight(){var today=new Date;today.setHours(0,0,0,0);var currentdate=today.toJSON().slice(0,10),nDate=currentdate.slice(8,10)+"/"+currentdate.slice(5,7)+"/"+currentdate.slice(0,4),endPointUrl=peopleURL+"/_api/Web/Lists/getbytitle('OnBoarding')/Items?$select=*&$Filter=Start_x0020_Date+eq+'"+nDate+"'",headers_accept="application/json;odata=verbose";axios.get(endPointUrl).then(response=>{if($.isArray(response.data.value)&&response.data.value.length){var newName=response.data.value[0].Title,firstName=newName.split(" ")[0],videoURL=response.data.value[0].TwoMinuteInterviewVideoURL;$("#NewStarterName").html(newName),$("#NewStarterName").val(newName),$("#NewStarterJobDescription").html(response.data.value[0].Position),null!=videoURL?($("#NewStarterInterview").html("Watch "+firstName+"'s My Favourite Things Video"),$("#TMIVideoURL").attr("name",videoURL)):$("#TMIVideoURL").attr("name",null),$(".NewStarter").removeClass("hideProfile")}else getTodaysUserProfile()})}function getTodaysUserProfile(){var endPointUrl=siteURL+"/_api/Web/Lists/getbytitle('UserProfileInfoV2')/Items?$select=*&$Filter=CurrentSelectedProfile+eq+'Yes'",headers_accept="application/json;odata=verbose";axios.get(endPointUrl).then(response=>{var person;$.isArray(response.data.value)&&response.data.value.length?showSpotlightProfile(response.data.value[0]):GetRandomUserProfile()}).catch((function(error){console.log("Spotlight Error"),console.log(error)}))}function GetRandomUserProfile(){var selectedUser,endPointUrl=siteURL+"_api/Web/Lists/getbytitle('UserProfileInfo')/Items?$select=*&$Filter=ExcludeFromFrontPagePromo+eq+'No'+and+PastSelectedProfile+ne+'Yes'&$top=1000",headers_accept="application/json;odata=verbose";axios.get(endPointUrl).then(response=>{for(var userCount=response.data.value.length,userHasPic=!1;0==userHasPic;){var randItem=Math.floor(Math.random()*userCount);selectedUser=response.data.value[randItem],userHasPic=checkFileExistence(selectedUser.PictureURL)}showSpotlightProfile(selectedUser);var itemProperties={CurrentSelectedProfile:"Yes",PastSelectedProfile:"Yes",DateLastSpotlight:new Date},updateSpotlight;UpdateListItemByid(selectedUser.ID,"UserProfileInfo",itemProperties).done(()=>{}).fail(error=>{console.log("Error Updating Profile"),console.log(error)})}).catch(error=>{console.log("Error Getting List Of Profiles"),console.log(error)})}function showSpotlightProfile(selectedUser){var WorkPhoneNumber=null!=selectedUser.WorkPhoneNumber?selectedUser.WorkPhoneNumber:"";$("#Spotlight").css("background","rgb(151, 0, 33)"),$("#profileID").val(selectedUser.Email),$("#ProfileBackground").attr("src",selectedUser.PictureURL),$("#profilePic").attr("src",selectedUser.PictureURL),$("#spotlightName").text("Meet "+selectedUser.FullName),$("#spotlightJobDescription").text(selectedUser.JobTitle),$("#spotlightEmail").text(selectedUser.Email),$("#spotlightPhone").text(WorkPhoneNumber),$(".Spotlight").removeClass("hideProfile")}function getCalendarEntries(){var today=new Date;today.setHours(0,0,0,0);var endPointUrl=siteURL+"/_api/Web/Lists/getbytitle('UpcomingEvents')/Items?$select=*&$Filter=Active+eq+1+and+EndDate+ge+'"+today.toISOString()+"'";return axios.get(endPointUrl)}function getFormattedCalendarEntries(CalEvents){var eventsArray=[];return CalEvents.forEach((function(entry){let eDate=moment(entry.EventDate).format("DD/MM/YYYY HH:MM:SS"),fDate=moment(entry.EndDate).format("DD/MM/YYYY HH:MM:SS"),linkURL=null!=entry.link?entry.link.Url:"";var event={id:entry.Id,name:entry.Title,startDate:eDate,eventDate:entry.EventDate,endDate:fDate,calEndDate:entry.EndDate,description:entry.Description,place:entry.Location,link:linkURL,target:"_blank"};null!=entry.Image&&(event.image=entry.Image.Url),eventsArray.push(event)})),eventsArray}function saveGridToSharePoint(positions){var positions,itemProperties={GridLayout:positions=localStorage.getItem("positions")},user,eMail=JSON.parse(localStorage.getItem("userDetails")).EmailAddress,profileID,Profile;getUserProfileByEmail(siteURL,eMail).then(response=>{profileID=response.data.value[0].ID,uProfile=UpdateListItemByid(profileID,"UserProfileInfo",itemProperties),uProfile.then(()=>{" "==positions&&window.location.reload()}).fail(error=>{console.log("Error Occurred Updating User Profile With Grid positions"),console.log(error)})}).catch(error=>{console.log("Error Occurred Getting Profile ID By Email"),console.log(error)})}$(window).on("load",(function(){})),$(document).ready((function(){$('[data-toggle="tooltip"]').tooltip(),$((function(){var options={float:!0,cellHeight:70,width:12};$(".grid-stack").gridstack(options),$(".grid-stack").data("gridstack").setStatic(!0),new function(){var items;this.staticWidgets=["BIG2"],this.grid=$(".grid-stack").data("gridstack"),this.loadGrid=function(){var items=JSON.parse(localStorage.getItem("positions"));return null!=items&&(this.grid.removeAll(),_.each(items,(function(node){this.grid.addWidget($('<div class="grid-stack-item"><div class="grid-stack-item-content">'+node.content+"</div></div>"),node.x,node.y,node.width,node.height,!1,node.minWidth,node.maxWidth,node.minHeight,node.maxHeight,node.id,node.noMove,node.noResize)}),this),initialise(),$(".slideContainer").removeClass("show"),setTimeout(this.bindEvents,4500),this.setStaticWidgets()),!1}.bind(this),this.saveGrid=function(){this.setStaticWidgets(),this.serializedData=_.map($(".grid-stack > .grid-stack-item:visible"),(function(el){var node=(el=$(el)).data("_gridstack_node");return{x:node.x,y:node.y,width:node.width,height:node.height,locked:node.locked,maxHeight:node.maxHeight,maxWidth:node.maxWidth,minHeight:node.minHeight,minWidth:node.minWidth,noMove:node.noMove,noResize:node.noResize,id:node.id,content:$(".grid-stack-item-content",el).parent().html()}}),this);var sd=JSON.stringify(this.serializedData);return localStorage.setItem("positions",sd),!1}.bind(this),$(".grid-stack").on("gsresizestop",(function(event,elem){})),this.revertToDefault=function(){localStorage.removeItem("positions"),window.location.reload(!0)}.bind(this),this.clearGrid=function(){return this.grid.removeAll(),!1}.bind(this),this.lockUnlock=function(){$("#lockIcon").toggleClass("fa-lock fa-lock-open");var toggle=$(".grid-stack").data("gridstack").opts.staticGrid;return $(".grid-stack").data("gridstack").setStatic(!toggle),gridLocked=!toggle,this.setStaticWidgets(),!1}.bind(this),this.iconlockUnlock=function(){this.lockUnlock(),$("#lockIcon").hasClass("fa-lock")&&this.saveGrid()}.bind(this),this.setStaticWidgets=function(){this.staticWidgets.forEach((function(widget){var el=$("[data-gs-id=BIG2]");$(".grid-stack").data("gridstack").resizable(el,!1),$(".grid-stack").data("gridstack").movable(el,!1),$(".grid-stack").data("gridstack").locked(el,!0)}))},this.bindEvents=function(){$(".slideContainer").addClass("show"),$("#lockIcon").unbind("click"),$("#loadIcon").unbind("click"),$("#loadDefaultIcon").unbind("click"),$("#lockIcon").click(this.iconlockUnlock),$("#loadIcon").click(this.loadGrid),$("#loadDefaultIcon").click(this.revertToDefault),$('[data-toggle="tooltip"]').tooltip()}.bind(this),this.refreshGridFromProfile=function(){axios("https://corporatedocument.sharepoint.com/_api/SP.UserProfiles.PeopleManager/GetMyProperties").then(response=>{var EmailAddress=response.data.Email,userProfile;getUserProfileByEmail(siteURL,EmailAddress).then(response=>{var localPositions=localStorage.getItem("positions"),serverPositions=response.data.value[0].GridLayout;serverPositions!=localPositions?(console.log("Local & Server Positions Are Not In Sync - Resetting"),localStorage.removeItem("positions"),localStorage.setItem("positions",serverPositions),this.loadGrid()):console.log("Local & Server Positions Are In Sync")})})}.bind(this),null!=JSON.parse(localStorage.getItem("positions"))?this.loadGrid():(initialise(),setTimeout(this.bindEvents,4500))}}))}));