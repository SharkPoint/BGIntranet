!function($){"use strict";$.breakingNews=function(element,options){var defaults={effect:"scroll",direction:"ltr",height:40,fontSize:"default",themeColor:"default",background:"default",borderWidth:1,radius:2,source:"html",rss2jsonApiKey:"",play:!0,delayTimer:4e3,scrollSpeed:2,stopOnHover:!0,position:"auto",zIndex:99999},ticker=this;ticker.settings={};var $element=$(element),element=element,_label=$element.children(".bn-label"),_news=$element.children(".bn-news"),_ul=_news.children("ul"),_li=_ul.children("li"),_controls=$element.children(".bn-controls"),_prev=_controls.find(".bn-prev").parent(),_action=_controls.find(".bn-action").parent(),_next=_controls.find(".bn-next").parent(),_pause=!1,_controlsIsActive=!0,_totalNews=_ul.children("li").length,_activeNews=0,_interval=!1,initializeSettings=function(){"fixed-top"===ticker.settings.position?$element.addClass("bn-fixed-top").css({"z-index":ticker.settings.zIndex}):"fixed-bottom"===ticker.settings.position&&$element.addClass("bn-fixed-bottom").css({"z-index":ticker.settings.zIndex}),"default"!=ticker.settings.fontSize&&$element.css({"font-size":ticker.settings.fontSize}),"default"!=ticker.settings.themeColor&&($element.css({"border-color":ticker.settings.themeColor,color:ticker.settings.themeColor}),_label.css({background:ticker.settings.themeColor})),"default"!=ticker.settings.background&&$element.css({background:ticker.settings.background}),$element.css({height:ticker.settings.height,"line-height":ticker.settings.height-2*ticker.settings.borderWidth+"px","border-radius":ticker.settings.radius,"border-width":ticker.settings.borderWidth}),_li.find(".bn-seperator").css({height:ticker.settings.height-2*ticker.settings.borderWidth})},setContainerWidth=function(){if(_label.length>0&&("rtl"==ticker.settings.direction?_news.css({right:_label.outerWidth()}):_news.css({left:_label.outerWidth()})),_controls.length>0){var controlsWidth=_controls.outerWidth();"rtl"==ticker.settings.direction?_news.css({left:controlsWidth}):_news.css({right:controlsWidth})}if("scroll"===ticker.settings.effect){var totalW=0;_li.each(function(){totalW+=$(this).outerWidth()}),totalW+=10,_ul.css({width:totalW})}},loadDataWithRSS2JSON=function(){var xhr=new XMLHttpRequest;xhr.onreadystatechange=function(){if(4==xhr.readyState&&200==xhr.status){var obj=JSON.parse(xhr.responseText),items="",showingField="";switch(ticker.settings.source.showingField){case"title":showingField="title";break;case"description":showingField="description";break;case"link":showingField="link";break;default:showingField="title"}var seperator="";void 0!==ticker.settings.source.seperator&&void 0!==typeof ticker.settings.source.seperator&&(seperator=ticker.settings.source.seperator);for(var i=0;i<obj.items.length;i++)ticker.settings.source.linkEnabled?items+='<li><a target="'+ticker.settings.source.target+'" href="'+obj.items[i].link+'">'+seperator+obj.items[i][showingField]+"</a></li>":items+="<li><a>"+seperator+obj.items[i][showingField]+"</a></li>";_ul.empty().append(items),_li=_ul.children("li"),_totalNews=_ul.children("li").length,setContainerWidth(),"scroll"!=ticker.settings.effect&&showThis(),_li.find(".bn-seperator").css({height:ticker.settings.height-2*ticker.settings.borderWidth}),playHandler()}},xhr.open("GET","https://api.rss2json.com/v1/api.json?rss_url="+ticker.settings.source.url+"&count="+ticker.settings.source.limit+"&api_key="+ticker.settings.source.rss2jsonApiKey,!0),xhr.send()},loadDataWithYQL=function(){var xmlhttp=new XMLHttpRequest;xmlhttp.open("GET","https://query.yahooapis.com/v1/public/yql?q="+encodeURIComponent('select * from rss where url="'+ticker.settings.source.url+'" limit '+ticker.settings.source.limit)+"&format=json",!0),xmlhttp.onreadystatechange=function(){if(4==xmlhttp.readyState)if(200==xmlhttp.status){var obj=JSON.parse(xmlhttp.responseText),items="",showingField="";switch(ticker.settings.source.showingField){case"title":showingField="title";break;case"description":showingField="description";break;case"link":showingField="link";break;default:showingField="title"}var seperator="";"undefined"!=ticker.settings.source.seperator&&void 0!==ticker.settings.source.seperator&&(seperator=ticker.settings.source.seperator);for(var i=0;i<obj.query.results.item.length;i++)ticker.settings.source.linkEnabled?items+='<li><a target="'+ticker.settings.source.target+'" href="'+obj.query.results.item[i].link+'">'+seperator+obj.query.results.item[i][showingField]+"</a></li>":items+="<li><a>"+seperator+obj.query.results.item[i][showingField]+"</a></li>";_ul.empty().append(items),_li=_ul.children("li"),_totalNews=_ul.children("li").length,setContainerWidth(),"scroll"!=ticker.settings.effect&&showThis(),_li.find(".bn-seperator").css({height:ticker.settings.height-2*ticker.settings.borderWidth}),playHandler()}else _ul.empty().append('<li><span class="bn-loader-text">'+ticker.settings.source.errorMsg+"</span></li>")},xmlhttp.send(null)},loadJSON=function(){$.getJSON(ticker.settings.source.url,function(data){var items="",showingField="";showingField="undefined"===ticker.settings.source.showingField?"title":ticker.settings.source.showingField;var seperator="";void 0!==ticker.settings.source.seperator&&void 0!==typeof ticker.settings.source.seperator&&(seperator=ticker.settings.source.seperator);for(var i=0;i<data.length&&!(i>=ticker.settings.source.limit);i++)ticker.settings.source.linkEnabled?items+='<li><a target="'+ticker.settings.source.target+'" href="'+data[i].link+'">'+seperator+data[i][showingField]+"</a></li>":items+="<li><a>"+seperator+data[i][showingField]+"</a></li>","undefined"===data[i][showingField]&&console.log('"'+showingField+'" does not exist in this json.');_ul.empty().append(items),_li=_ul.children("li"),_totalNews=_ul.children("li").length,setContainerWidth(),"scroll"!=ticker.settings.effect&&showThis(),_li.find(".bn-seperator").css({height:ticker.settings.height-2*ticker.settings.borderWidth}),playHandler()})},startScrollAnimationLTR=function(){var _ulPosition=parseFloat(_ul.css("marginLeft"));_ulPosition-=ticker.settings.scrollSpeed/2,_ul.css({marginLeft:_ulPosition}),_ulPosition<=-_ul.find("li:first-child").outerWidth()&&(_ul.find("li:first-child").insertAfter(_ul.find("li:last-child")),_ul.css({marginLeft:0})),!1===_pause&&(window.requestAnimationFrame&&requestAnimationFrame(startScrollAnimationLTR)||setTimeout(startScrollAnimationLTR,16))},startScrollAnimationRTL=function(){var _ulPosition=parseFloat(_ul.css("marginRight"));_ulPosition-=ticker.settings.scrollSpeed/2,_ul.css({marginRight:_ulPosition}),_ulPosition<=-_ul.find("li:first-child").outerWidth()&&(_ul.find("li:first-child").insertAfter(_ul.find("li:last-child")),_ul.css({marginRight:0})),!1===_pause&&(window.requestAnimationFrame&&requestAnimationFrame(startScrollAnimationRTL)||setTimeout(startScrollAnimationRTL,16))},scrollPlaying=function(){"rtl"===ticker.settings.direction?_ul.width()>_news.width()&&startScrollAnimationRTL():_ul.width()>_news.width()&&startScrollAnimationLTR()},scrollGoNextLTR=function(){_ul.stop().animate({marginLeft:-_ul.find("li:first-child").outerWidth()},300,function(){_ul.find("li:first-child").insertAfter(_ul.find("li:last-child")),_ul.css({marginLeft:0}),_controlsIsActive=!0})},scrollGoNextRTL=function(){_ul.stop().animate({marginRight:-_ul.find("li:first-child").outerWidth()},300,function(){_ul.find("li:first-child").insertAfter(_ul.find("li:last-child")),_ul.css({marginRight:0}),_controlsIsActive=!0})},scrollGoPrevLTR=function(){var _ulPosition;parseInt(_ul.css("marginLeft"),10)>=0&&(_ul.css({"margin-left":-_ul.find("li:last-child").outerWidth()}),_ul.find("li:last-child").insertBefore(_ul.find("li:first-child"))),_ul.stop().animate({marginLeft:0},300,function(){_controlsIsActive=!0})},scrollGoPrevRTL=function(){var _ulPosition;parseInt(_ul.css("marginRight"),10)>=0&&(_ul.css({"margin-right":-_ul.find("li:last-child").outerWidth()}),_ul.find("li:last-child").insertBefore(_ul.find("li:first-child"))),_ul.stop().animate({marginRight:0},300,function(){_controlsIsActive=!0})},scrollNext=function(){"rtl"===ticker.settings.direction?scrollGoNextRTL():scrollGoNextLTR()},scrollPrev=function(){"rtl"===ticker.settings.direction?scrollGoPrevRTL():scrollGoPrevLTR()},effectTypography=function(){_ul.find("li").hide(),_ul.find("li").eq(_activeNews).width(30).show(),_ul.find("li").eq(_activeNews).animate({width:"100%",opacity:1},1500)},effectFade=function(){_ul.find("li").hide(),_ul.find("li").eq(_activeNews).fadeIn()},effectSlideDown=function(){_totalNews<=1?_ul.find("li").animate({top:30,opacity:0},300,function(){$(this).css({top:-30,opacity:0,display:"block"}),$(this).animate({top:0,opacity:1},300)}):(_ul.find("li:visible").animate({top:30,opacity:0},300,function(){$(this).hide()}),_ul.find("li").eq(_activeNews).css({top:-30,opacity:0}).show(),_ul.find("li").eq(_activeNews).animate({top:0,opacity:1},300))},effectSlideUp=function(){_totalNews<=1?_ul.find("li").animate({top:-30,opacity:0},300,function(){$(this).css({top:30,opacity:0,display:"block"}),$(this).animate({top:0,opacity:1},300)}):(_ul.find("li:visible").animate({top:-30,opacity:0},300,function(){$(this).hide()}),_ul.find("li").eq(_activeNews).css({top:30,opacity:0}).show(),_ul.find("li").eq(_activeNews).animate({top:0,opacity:1},300))},effectSlideLeft=function(){_totalNews<=1?_ul.find("li").animate({left:"50%",opacity:0},300,function(){$(this).css({left:-50,opacity:0,display:"block"}),$(this).animate({left:0,opacity:1},300)}):(_ul.find("li:visible").animate({left:"50%",opacity:0},300,function(){$(this).hide()}),_ul.find("li").eq(_activeNews).css({left:-50,opacity:0}).show(),_ul.find("li").eq(_activeNews).animate({left:0,opacity:1},300))},effectSlideRight=function(){_totalNews<=1?_ul.find("li").animate({left:"-50%",opacity:0},300,function(){$(this).css({left:"50%",opacity:0,display:"block"}),$(this).animate({left:0,opacity:1},300)}):(_ul.find("li:visible").animate({left:"-50%",opacity:0},300,function(){$(this).hide()}),_ul.find("li").eq(_activeNews).css({left:"50%",opacity:0}).show(),_ul.find("li").eq(_activeNews).animate({left:0,opacity:1},300))},showThis=function(){switch(_controlsIsActive=!0,ticker.settings.effect){case"typography":effectTypography();break;case"fade":effectFade();break;case"slide-down":effectSlideDown();break;case"slide-up":effectSlideUp();break;case"slide-left":effectSlideLeft();break;case"slide-right":effectSlideRight();break;default:_ul.find("li").hide(),_ul.find("li").eq(_activeNews).show()}},nextHandler=function(){switch(ticker.settings.effect){case"scroll":scrollNext();break;default:++_activeNews>=_totalNews&&(_activeNews=0),showThis()}},prevHandler=function(){switch(ticker.settings.effect){case"scroll":scrollPrev();break;default:--_activeNews<0&&(_activeNews=_totalNews-1),showThis()}},playHandler=function(){if(_pause=!1,ticker.settings.play)switch(ticker.settings.effect){case"scroll":scrollPlaying();break;default:ticker.pause(),_interval=setInterval(function(){ticker.next()},ticker.settings.delayTimer)}};ticker.init=function(){if(ticker.settings=$.extend({},defaults,options),initializeSettings(),$element.addClass("bn-effect-"+ticker.settings.effect+" bn-direction-"+ticker.settings.direction),setContainerWidth(),"object"==typeof ticker.settings.source)switch(ticker.settings.source.type){case"rss":"rss2json"===ticker.settings.source.usingApi?loadDataWithRSS2JSON():loadDataWithYQL();break;case"json":loadJSON();break;default:console.log('Please check your "source" object parameter. Incorrect Value')}else"html"===ticker.settings.source?("scroll"!=ticker.settings.effect&&showThis(),playHandler()):console.log('Please check your "source" parameter. Incorrect Value');ticker.settings.play?_action.find("span").removeClass("bn-play").addClass("bn-pause"):_action.find("span").removeClass("bn-pause").addClass("bn-play"),$element.on("mouseleave",function(e){var activePosition=$(document.elementFromPoint(e.clientX,e.clientY)).parents(".bn-breaking-news")[0];$(this)[0]!==activePosition&&(!0===ticker.settings.stopOnHover?!0===ticker.settings.play&&ticker.play():!0===ticker.settings.play&&!0===_pause&&ticker.play())}),$element.on("mouseenter",function(){!0===ticker.settings.stopOnHover&&ticker.pause()}),_next.on("click",function(){_controlsIsActive&&(_controlsIsActive=!1,ticker.pause(),ticker.next())}),_prev.on("click",function(){_controlsIsActive&&(_controlsIsActive=!1,ticker.pause(),ticker.prev())}),_action.on("click",function(){_controlsIsActive&&(_action.find("span").hasClass("bn-pause")?(_action.find("span").removeClass("bn-pause").addClass("bn-play"),ticker.stop()):(ticker.settings.play=!0,_action.find("span").removeClass("bn-play").addClass("bn-pause")))}),$(window).on("resize",function(){$element.width()<480?(_label.hide(),"rtl"==ticker.settings.direction?_news.css({right:0}):_news.css({left:0})):(_label.show(),"rtl"==ticker.settings.direction?_news.css({right:_label.outerWidth()}):_news.css({left:_label.outerWidth()}))})},ticker.pause=function(){_pause=!0,clearInterval(_interval)},ticker.stop=function(){_pause=!0,ticker.settings.play=!1},ticker.play=function(){playHandler()},ticker.next=function(){nextHandler()},ticker.prev=function(){prevHandler()},ticker.init()},$.fn.breakingNews=function(options){return this.each(function(){if(null==$(this).data("breakingNews")){var ticker=new $.breakingNews(this,options);$(this).data("breakingNews",ticker)}})}}(jQuery);