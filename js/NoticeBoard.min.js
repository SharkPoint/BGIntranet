function shuffle(array){for(var currentIndex=array.length,temporaryValue,randomIndex;0!==currentIndex;)randomIndex=Math.floor(Math.random()*currentIndex),temporaryValue=array[currentIndex-=1],array[currentIndex]=array[randomIndex],array[randomIndex]=temporaryValue;return array}function getRandomInt(min,max){return min=Math.ceil(min),max=Math.floor(max),Math.floor(Math.random()*(max-min+1))+min}$(document).ready(function(){function formatResult(item){return item.Title}function formatSelection(item){return item.Title}function getURLParam(name,url){for(var query_string,params=(url=decodeURIComponent(url)).split("?")[1].split("&"),i=0;i<params.length;){var param_item=params[i].split("=");if(param_item[0]==name)return param_item[1];i++}return""}$(".newNote").on("submit",function(e){return 1==vm_Main.EditMode?vm_Main.updateNote():vm_Main.saveNewNote(),!1}),$(".test-bgImage").click(()=>{var link=$("#bgImage").val();""!=link&&window.open(link,"_blank")}),$(".test-bgLink").click(()=>{var link=$("#bgLink").val();""!=link&&window.open(link,"_blank")}),$(".selectCompany").select2({width:"100%",placeholder:"Company",minimumResultsForSearch:1/0}),$("#newFaq").click(()=>{vm_Main.createNewNote()}),$("#SaveNewFAQ").click(function(e){SaveNewFaq()})}),document.onreadystatechange=function(){"complete"===document.readyState&&$(".loadingSpinner").fadeOut(50)},vm_Main=new Vue({el:".main",data:{allPosts:[],currentNoteID:null,EditMode:!1,bgImage:null,bgLink:null,validateFields:[{name:"#nbTitle",css:"#nbTitle"},{name:"#nbDescription",css:"#nbDescription"},{name:".nbCompany .selectCompany",css:".nbCompany .select2-container--default .select2-selection--single"},{name:"#creatorsPhone",css:"#creatorsPhone"}],refreshFields:[{name:"#nbTitle",css:"#nbTitle"},{name:"#nbDescription",css:"#nbDescription"},{name:".nbCompany .selectCompany",css:".nbCompany .select2-container--default .select2-selection--single"},{name:"#creatorsPhone",css:"#creatorsPhone"},{name:"#bgImage",css:"#bgImage"},{name:"#bgLink",css:"#bgLink"}]},created:function(){this.getPosts()},methods:{getPosts:function(){var vm=this,endPointUrl=siteURL+"/_api/Web/Lists/getbytitle('NoticeBoard')/Items?$select=Author/Title,BGPhoneNumber,Author/EMail,BGImage,BGLink,Title,ID,Description,NumberOfViews,Created,ThumbsUp,ThumbsDown&$expand=Author&$filter=BGStatus eq 'Active'&$orderby=Created desc";axios.get(endPointUrl).then(response=>{var responses=response.data.value;vm.allPosts=[],responses.forEach(elem=>{console.log(elem);var nbPost=[];nbPost.ID=elem.ID,nbPost.Title=elem.Title,nbPost.Description=elem.Description,nbPost.Author=elem.Author.Title,nbPost.Email="mailto:"+elem.Author.EMail+"?Subject="+elem.Title,nbPost.PhoneNumber=elem.BGPhoneNumber,nbPost.Image=elem.BGImage,nbPost.Link=elem.BGLink,nbPost.Style=getColour(),nbPost.ActiveImage=null!=elem.BGImage,nbPost.ActiveLink=null!=elem.BGLink,nbPost.ActiveDelete=JSON.parse(localStorage.getItem("userDetails")).DisplayName==elem.Author.Title,nbPost.LighboxVal=null!=elem.BGImage&&elem.ID,vm.allPosts.push(nbPost)}),console.log(vm.allPosts),vm.$nextTick(function(){handlePagination()})})},searchPosts:function(){var term=""==$("#searchTerm").val()?"*":$("#searchTerm").val(),termCompany=""==$(".selectCompany").val()||"All"==$(".selectCompany").val()?"*":$(".selectCompany").val(),termCompany="CDS DS"==$(".selectCompany").val()?"CDSDS":termCompany,termMonth=""==$(".selectMonth").val()||"0"==$(".selectMonth").val()?"*":$(".selectMonth").val(),termYear=""==$(".selectYear").val()?"*":$(".selectYear").val(),vm=this,url=siteURL+"_api/search/query?querytext='("+term+")+AND+(path:https://corporatedocument.sharepoint.com/sites/bgintranet/Lists/NoticeBoard)+AND+ContentType:Item+AND+RefinableString100:Active+AND+RefinableString07:"+termCompany+"'&enableSorting=true&sortlist='Created:descending'&selectproperties='ListItemID,Title,Author,Description,RefinableString07,RefinableString08,RefinableString09,RefinableString10,RefinableString100'&rowlimit='100'";axios(url).then(function(response){var results=response.data.PrimaryQueryResult.RelevantResults.Table.Rows;console.log(results),vm.allPosts=[],results.forEach(element=>{var postArray=[];element.Cells.forEach(key=>{switch(key.Key){case"ListItemID":postArray.ID=key.Value;break;case"Title":postArray.Title=key.Value;break;case"Description":postArray.Description=key.Value;break;case"Author":postArray.Author=key.Value,postArray.ActiveDelete=JSON.parse(localStorage.getItem("userDetails")).DisplayName==key.Value;break;case"RefinableString10":postArray.PhoneNumber=key.Value;break;case"RefinableString08":postArray.Image=key.Value,postArray.ActiveImage=""!=key.Value;break;case"RefinableString09":postArray.Link=key.Value,postArray.ActiveLink=""!=key.Value}postArray.Style=getColour()}),vm.allPosts.push(postArray)}),console.log(vm.allPosts),vm.$nextTick(function(){handlePagination()})}).catch(function(error){console.log(error)})},deletePost:function(){var noteID=event.target.getAttribute("ID");$(event.target).hasClass("active")&&swal({title:"Are You Sure?",text:"Once deleted, you will not be able to recover this note!",icon:"warning",buttons:!0,dangerMode:!0}).then(willDelete=>{if(willDelete){var itemProperties={BGStatus:"Deleted"},update;UpdateListItemByid(noteID,"NoticeBoard",itemProperties).done(response=>{swal("Your Note Has Been Deleted",{icon:"success",timer:2500}),this.getPosts()})}})},createNewNote:function(){this.EditMode=!1,this.resetFields();var userDetails=JSON.parse(localStorage.getItem("userDetails"));$("#creatorsName").val(userDetails.DisplayName),$("#creatorsPhone").val(userDetails.WorkPhone),$(".modal-title").html("Create New Note"),$("#NewNoteModal").modal("toggle")},editNote:function(){var nbPost;this.currentNoteID=$(event.target).closest(".notePost")[0].id,this.EditMode=!0,getNoticeBoardById(siteURL,this.currentNoteID).then(response=>{var notePost=response.data.value[0],authorName;getUserByID(notePost.AuthorId).then(uProfileResponse=>{var aName=uProfileResponse.data.Title;console.log(aName),JSON.parse(localStorage.getItem("userDetails")).DisplayName==aName?($("#nbTitle").val(notePost.Title),$("#nbDescription").val(notePost.Description),$("#CompanyCombo").val(notePost.BGCompany).trigger("change"),$("#bgImage").val(notePost.BGImage),$("#bgLink").val(notePost.BGLink),$("#creatorsName").val(uProfileResponse.data.Title),$("#creatorsPhone").val(notePost.BGPhoneNumber),$(".modal-title").html("Edit Note"),$("#NewNoteModal").modal("toggle")):swal("Stop","You Are Not Able To Edit This Note",{icon:"info",timer:2500})})})},updateNote:function(){var vm=this,itemProperties={},update;itemProperties.Title=$("#nbTitle").val(),itemProperties.Description=$("#nbDescription").val(),itemProperties.BGCompany="CDS DS"==$("#CompanyCombo").val()?"CDSDS":$("#CompanyCombo").val(),itemProperties.BGImage=$("#bgImage").val(),itemProperties.BGLink=$("#bgLink").val(),itemProperties.BGPhoneNumber=$("#creatorsPhone").val(),UpdateListItemByid(vm.currentNoteID,"NoticeBoard",itemProperties).done(response=>{this.getPosts(),$("#NewNoteModal").modal("toggle")})},resetFields:function(){this.refreshFields.forEach(el=>{$(el.name).val(""),$(el.css).css("border","1px solid #ced4da")}),$("#CompanyCombo").val("").trigger("change")},validateForm:function(){var vm=this,validArray=[],valid;return this.validateFields.forEach(el=>{""==$(el.name).val()?($(el.css).css("border","1px solid red"),vm.valid=!1):($(el.css).css("border","1px solid #ced4da"),vm.valid=!0),validArray.push(vm.valid)}),validArray},saveNewNote:function(){var validNote;if(!this.validateForm().includes(!1)){var vm=this,itemProperties={},updateList;itemProperties.Title=$("#nbTitle").val(),itemProperties.Description=$("#nbDescription").val(),itemProperties.BGCompany=$("#CompanyCombo").val(),itemProperties.BGImage=$("#bgImage").val(),itemProperties.BGLink=$("#bgLink").val(),itemProperties.BGPhoneNumber=$("#creatorsPhone").val(),itemProperties.BGStatus="Awaiting Approval",createSPListItem(siteURL,"NoticeBoard",itemProperties).then(function(){console.log("New Note Saved Sucessfully"),vm.getPosts(),$("#NewNoteModal").modal("toggle"),swal("Submitted For Approval","You Will Receive An Email Once Approval Is Complete",{icon:"success",timer:3e3})}).catch(function(error){console.log("Notice Save Failed"),console.log(error),swal("There was a problem saving your New Notice","Please try again",{icon:"error"})})}},setImage:function(field,link){}}}),getColour=function(){let COLORS;return["green","yellow","orange","pink","blue"][getRandomInt(0,4)]},$(".breadcrumb").click(function(){location.reload(!0)}),handlePagination=function(){var items=$(".list-wrapper .list-item"),numItems=items.length,perPage=9;items.slice(9).hide(),$("#pagination-container").pagination({items:numItems,itemsOnPage:9,prevText:"Prev",nextText:"Next",onPageClick:function(pageNumber){var showFrom=9*(pageNumber-1),showTo=showFrom+9;items.hide().slice(showFrom,showTo).show()}})};