$(document).ready((function(){$(".alphaNavItem").click((function(event){vm_Main.getUserByInitial(event)})),$("#backButton").click((function(){vm_Main.closeProfile()})),$(".mobileBack").click((function(){vm_Main.closeProfile()})),$(".selectCompany").select2({width:"100%",placeholder:"Company",minimumResultsForSearch:1/0}),$(".selectLocation").select2({width:"100%",placeholder:"Location",minimumResultsForSearch:1/0})})),document.onreadystatechange=function(){"complete"===document.readyState&&$(".loadingSpinner").fadeOut(50)},vm_Main=new Vue({el:"#wrapper",data:{allUsers:[],filteredUsers:[],searchResults:[],showProfile:!1,profileOnly:!1,paramSearch:!1,showNoResults:!1,selectedProfile:{}},created:function(){this.initialise()},methods:{initialise:function(){var vm=this,p_eMail=qs("p"),p_jobTitle=qs("j"),p_location=qs("l");if(null!=p_eMail||null!=p_jobTitle||null!=p_location){if(null!=p_eMail)return vm.profileOnly=!0,void vm.showUserProfileFromList(p_eMail);vm.paramSearch=!0,vm.getUsers()}else vm.getUsers()},getUsers:function(){var vm=this;vm.showNoResults=!1;var endPointUrl=siteURL+"/_api/Web/Lists/getbytitle('UserProfileInfoV2')/Items?$filter=(Email ne null and ProfileVisible eq '1')&$orderby=PersonName asc&$top=999";axios.get(endPointUrl).then(response=>{var responses=response.data.value;if(vm.allUsers=responses,vm.paramSearch){var jobTitle=qs("j"),location=qs("l");vm.searchUsersFromParams(jobTitle,location),vm.paramSearch=!1}else vm.filteredUsers=vm.allUsers.filter((function(el){return el.FullName.startsWith("A")}));vm.$nextTick((function(){vm.handlePagination()}))})},searchUsersFromParams(p_jobTitle,p_location){if(null!=p_jobTitle&&$("#searchTerm").val(p_jobTitle),null!=p_location){var optionValues=[],sLocation=jsUcfirst(p_location);$("#LocationSearch option").each((function(){optionValues.push($(this).val())}));var optionIndex=optionValues.findIndex(element=>element.includes(sLocation));$("#LocationSearch").val(optionValues[optionIndex]),$("#LocationSearch").select2().trigger("change")}this.searchUsers(""==p_jobTitle||null==p_jobTitle?"*":p_jobTitle,"*",null==p_location||""==p_location?"*":jsUcfirst(p_location))},searchUsersFromSearchFields(){if(""!=$("#searchTerm").val()||""!=$(".selectCompany").val()||""!=$(".selectLocation").val()){var term=""==$("#searchTerm").val()?"*":$("#searchTerm").val(),termCompany=""==$(".selectCompany").val()||"All"==$(".selectCompany").val()?"*":$(".selectCompany").val(),termCompany="CDS DS"==$(".selectCompany").val()?"CDSDS":termCompany,termLocation=""==$(".selectLocation").val()||"All"==$(".selectLocation").val()?"*":$(".selectLocation").val();this.searchUsers(term,termCompany,termLocation)}},searchUsers:function(term,termCompany,termLocation){var vm=this,termArray=[],companyArray=[];if(console.log("term - "+term),console.log("termCompany - "+termCompany),console.log("termLocation - "+termLocation),vm.showNoResults=!1,"*"==term&"*"==termCompany&"*"==termLocation)return vm.filteredUsers=vm.allUsers.slice(0),void vm.$nextTick((function(){vm.handlePagination()}));termArray="*"!=term?vm.allUsers.filter((function(el){var jobTitle=null==el.JobTitle?"":el.JobTitle,fullName;return((null==el.FullName?"":el.FullName).toLowerCase()+jobTitle.toLowerCase()).includes(term.toLowerCase())})):vm.allUsers.slice(0),companyArray="*"!=termCompany?termArray.filter((function(el){return el.Company==termCompany})):termArray.slice(0),vm.searchResults="*"!=termLocation?companyArray.filter((function(el){return null!=el.Office&&el.Office.includes(termLocation)})):companyArray.slice(0),Array.isArray(vm.searchResults)&&vm.searchResults.length?(vm.showNoResults=!1,vm.filteredUsers=vm.searchResults.slice(0)):(vm.showNoResults=!0,vm.filteredUsers=[]),console.log(vm.filteredUsers),vm.$nextTick((function(){vm.handlePagination(),$(".alphaNavItem").removeClass("selectedAlpha"),$(".alphaNav li:nth-child(1) .alphaNavItem").addClass("selectedAlpha")}))},getUserByInitial:function(event){var vm=this,filterSource=[],initialLetter=event.target.innerHTML;$(".alphaNavItem").removeClass("selectedAlpha"),$(event.target).addClass("selectedAlpha"),filterSource=Array.isArray(vm.searchResults)&&vm.searchResults.length?vm.searchResults.slice(0):vm.allUsers.slice(0),vm.filteredUsers="*"==initialLetter?filterSource.slice(0):filterSource.filter((function(el){return el.FullName.startsWith(initialLetter)})),vm.showNoResults=!Array.isArray(vm.filteredUsers)||!vm.filteredUsers.length,vm.$nextTick((function(){vm.handlePagination()}))},clearAllSearch:function(){var vm=this;$("#searchTerm").val(""),$(".selectCompany").val(null).trigger("change"),$(".selectLocation").val(null).trigger("change"),vm.searchResults=[],vm.filteredUsers=vm.allUsers.filter((function(el){return el.FullName.startsWith("A")})),$(".alphaNavItem").removeClass("selectedAlpha"),$(".alphaNav li:nth-child(2) .alphaNavItem").addClass("selectedAlpha"),vm.showNoResults=!1,vm.$nextTick((function(){vm.handlePagination()}))},handlePagination:function(){$("#pagination-container").pagination("destroy"),$(".person").removeAttr("style");var items=$(".person"),numItems=items.length,perPage=18,vm=this;items.slice(18).hide(),$("#pagination-container").pagination({items:numItems,itemsOnPage:18,prevText:"Prev",nextText:"Next",onPageClick:function(pageNumber){var showFrom=18*(pageNumber-1),showTo=showFrom+18;items.hide().slice(showFrom,showTo).show()}}),$(".person").unbind(),$(".person").click((function(event){vm.showUserProfile(vm.getEmailAddressFromSelected(event))}))},getEmailAddressFromSelected:function(event){return $(event.target).closest("li").find(".userEmail")[0].value},showUserProfileFromList:function(userEmail){var vm=this,endPointUrl=siteURL+"/_api/Web/Lists/getbytitle('UserProfileInfoV2')/Items?$filter=Email eq '"+userEmail+"'";axios.get(endPointUrl).then(response=>{vm.selectedProfile=response.data.value[0],vm.addExtraGoodiesToProfile(),this.showProfile=!0})},addExtraGoodiesToProfile(){var vm=this;switch(vm.selectedProfile.skypeaddress="sip:"+vm.selectedProfile.Email,vm.selectedProfile.mailtoaddress="mailto:"+vm.selectedProfile.Email,vm.selectedProfile.Company){case"CDSDS":vm.selectedProfile.CompanyImage="./assets/images/mm_images/CDS_DS_Large_Transparent.png";break;case"CDS":vm.selectedProfile.CompanyImage="./assets/images/mm_images/cds2020.png";break;case"BGBS":vm.selectedProfile.CompanyImage="./assets/images/mm_images/bgbs_Bailie.png";break;case"Newspress":vm.selectedProfile.CompanyImage="./assets/images/mm_images/newspress.png";break;case"The Baird Group":vm.selectedProfile.CompanyImage="./assets/images/mm_images/Group_Bailie.png";case"Bailie Group":vm.selectedProfile.CompanyImage="./assets/images/mm_images/Group_Bailie.png"}},showUserProfile:function(userEmail){var vm=this;console.log(userEmail);var chosenProfile=[];chosenProfile=vm.allUsers.filter((function(el){return el.Email==userEmail})),vm.selectedProfile=chosenProfile[0],console.log(vm.selectedProfile),vm.addExtraGoodiesToProfile(),console.log(this.selectedProfile),this.showProfile=!0},closeProfile:function(){var vm;this.profileOnly?window.open("./index.aspx",target="_self"):this.showProfile=!1},mobileBack:function(){alert("mobileback")}}});