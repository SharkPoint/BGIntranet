$(document).ready((function(){$("input[type=radio][name=css-fadeshow]").change((function(){vm_slideShow.currentSelection=$(event.target)[0].id.split("-")[1]}));var currentAmount=15,alertBanneralertBanner=new Vue({el:"#AlertContainer",data:{alertTitle:"",alertTitleMobile:"",alertLinkText:"",alertLink:"",alertArchiveText:"",alertArchive:""},created:function(){this.setAlert()},methods:{setAlert:function(){console.log("Running SetAlert");var vm=this,requestUri=peopleURL+"\\_api\\web\\lists\\getbytitle('Alert Banner')\\items?&$filter=Status eq 'Active'&orderby=modified desc&top=1",response;console.log(requestUri),axios(requestUri).then((function(response){if(response.data.value.length>0){var newsPageURL="news.aspx?pageURL=https://corporatedocument.sharepoint.com/sites/groupnews/SitePages/",alert=response.data.value[0];switch(console.log("Alert"),console.log(alert),vm.alertTitle=alert.Title,vm.alertTitleMobile=alert.Mobile_x0020_Alert_x0020_Title,null!=alert.AlertText&&null!=alert.AlertLink&&(vm.alertTitle=vm.alertTitle+" - ",vm.alertLinkText=alert.AlertText,vm.alertLink=newsPageURL+alert.AlertLink),null!=alert.ArchiveText&&null!=alert.ArchiveSearchTerm&&(vm.alertArchiveText=alert.ArchiveText,vm.alertArchive="NewsArchive.aspx?srch="+alert.ArchiveSearchTerm),alert.BannerColour){case"Red":$("#alertBanner").addClass("redAlert");break;case"Amber":$("#alertBanner").addClass("amberAlert");break;case"Green":$("#alertBanner").addClass("greenAlert");break;case"Blue":$("#alertBanner").addClass("blueAlert")}$("#AlertContainer").removeClass("hideElement")}}))},OpenAlert:function(){window.open(this.alertLink,"_self")},OpenArchive:function(){window.open(this.alertArchive,"_self")}}}),userDetails=new Vue({el:"#EmailContent",data:{EmailAddress:null,OneDriveAddress:null,AccountName:null,Company:null},created:function(){this.getCurrentUser()},methods:{getCurrentUser:function(){var WorkPhone;sessionStorage.clear(),axios("https://corporatedocument.sharepoint.com/_api/SP.UserProfiles.PeopleManager/GetMyProperties").then(response=>{response.data.UserProfileProperties.forEach(key=>{switch(key.Key){case"WorkPhone":WorkPhone=key.Value;break;case"Office":Office=key.Value}}),console.log("My Details"),console.log(response.data);var uDetails={DisplayName:response.data.DisplayName.replace(/\'/gi,""),OneDriveAddress:response.data.PersonalUrl+"/_layouts/15/onedrive.aspx",EmailAddress:response.data.Email,WorkPhone:WorkPhone,Office:Office,AccountName:response.data.AccountName,Company:response.data.Email.split("@").pop().split(".").shift().toLowerCase()},endPointUrl=siteURL+"/_api/Web/Lists/getbytitle('Permissions')/Items?$select=Roles,UserNAme/Title&$expand=UserNAme&$filter=UserNAme/Title eq '"+encodeURI(uDetails.DisplayName)+"'";axios.get(endPointUrl).then(response=>{var roles=[],userMatches=response.data.value;Array.isArray(userMatches)&&userMatches.length&&(roles=userMatches[0].Roles),uDetails.Roles=roles,localStorage.setItem("userDetails",JSON.stringify(uDetails))})}).catch(error=>{console.log("Current User Error - "+error)})}}}),newsTicker=new Vue({el:"#NewsItems",data:{newsItems:[]},created:function(){this.getNews()},methods:{getNews:function(){var vm=this,r2J="https://api.rss2json.com/v1/api.json?rss_url=",api_key="j1nd29hylspxrhpd5r6yo4e2wdhrccikjvjtizeb",linkArray;["http://feeds.bbci.co.uk/news/rss.xml","http://feeds.bbci.co.uk/news/technology/rss.xml","http://newsrss.bbc.co.uk/rss/sportonline_uk_edition/football/rss.xml"].forEach(link=>{var nItem=null;axios(r2J+encodeURIComponent(link)+"&api_key="+api_key).then(response=>{response.data.items.forEach(element=>{nItem={Title:element.title,Link:element.link,Thumb:""!=element.thumbnail?element.thumbnail:"././assets/images/MissingImage.jpg",Description:element.description};var id=/[^/]*$/.exec(element.link)[0],secLink=element.link.replace("http:","https:"),secThumb=nItem.Thumb.replace("http:","https:");$("#NewsItems").append('<li><a nlink="'+secLink+'" thumb="'+secThumb+'" description="'+element.description+'" onclick="showNews($(this).attr(\'id\'))" + id='+id+' target="_blank"><span class="tab">'+element.title+"&nbsp;&nbsp;&nbsp;&nbsp;//</span></a></li>")}),$("#newsTicker5").breakingNews({})}).catch(error=>{console.log("News - "+error)})})}}}),vm_slideShow=new Vue({el:".fs-slides",data:{slides:[],currentSelection:1},created:function(){this.getNewNews()},methods:{getNewNews:function(){console.log("OFFICE");var user,office=JSON.parse(localStorage.getItem("userDetails")).Office,requestUri=newsURL+"\\_api\\web\\lists\\getbytitle('Site Pages')\\items?$select=EncodedAbsUrl,PagePosition,OData__ModerationStatus,DisplayInCarousel,ID,ExcludeFrom,Title,BannerImageUrl,Description&$filter=((DisplayInCarousel eq 'Yes') and (ExcludeFrom ne '"+office+"') and (OData__ModerationStatus eq 0))&$top=6&$orderby=Modified desc";console.log(requestUri);var vm=this,sitePages;axios(requestUri).then((function(response){vm.slides=response.data.value,vm.slides.forEach((function(element,i){element.imgURL="url("+element.BannerImageUrl.Url+"&resolution=5 )",element.newsLink=intranetNews+"?pageURL="+element.EncodedAbsUrl,element.BGTitle=element.Title.substring(0,60)})),vm.$nextTick((function(){setTimeout(()=>{vm.updateSlideshow()},15e3)}))})).catch((function(error){console.log(error)}))},showNews:function(pURL){var newsURL=this.slides[this.currentSelection-1].newsLink;window.open(newsURL,"_self")},updateSlideshow:function(){var vm=this,noSlides=vm.slides.length,interval=setInterval((function(){var slideNo=parseInt(vm.currentSelection);vm.currentSelection=slideNo==noSlides?"1":(slideNo+1).toString();var elem="#slide-"+vm.currentSelection;$(elem).trigger("click")}),1e4)}}});checkFileExistence=function(file){return result=!1,jQuery.ajaxSetup({async:!1}),$.get(file).done((function(){result=!0})).fail((function(){result=!1})),jQuery.ajaxSetup({async:!0}),result}}));